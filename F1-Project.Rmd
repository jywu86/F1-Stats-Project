---
title: "F1 Project (E109"
author: "John Wu and Scotty Smith"
date: "4/22/2022"
output:
  pdf_document: default
  html_document: default
---

# Background and Purpose

Formula 1 also known as F1 is a series of races (Grand Prix) that take place all across the world including countries from Europe, Asia, North America, and the Middle East. The sport has been around since the early 1950s and is considered as the premier league for open wheel racing. Points are awarded in each race to both the driver and the team that the driver belongs to. Each team is allowed two drivers with closely matched cars and currently (2022) there are 10 teams with 20 drivers in total. Each year two championships are awarded; one for the driver with the most points and the overall team (or constructor).

Historically, F1 has been classified into three main tiers: "Top Teams", "Midfield" (AKA Formula 1.5), and "Backmarkers". A large reason why these top teams remain on top is due to the much larger budgets and can be up to four times the budget of a smaller team. The bulk of these larger teams' budgets is spent in development and can be many years ahead of teams considered in the backmarker. The same can be said for drivers, where the top driver from Mercedes (Lewis Hamilton) makes approximately \$30 million and the best driver from the backmarker team Haas (Mich Schumacher) makes approximately \$1 million. However, in 2020 a budget cap was agreed upon and team budgets are maximized at \$145 million per year. Currently, this does not include driver salaries however it would not be unfathomable to believe a salary cap may also be enforced in the future like many other professional sports.

The purpose of this project is to use classification models to understand the effect of which factors are the most important for top-tier, mid-pack, and back-marker and what would be an ideal strategy for each team aiming to move from each tier. Also to answer the question of how well does each driver reflect their current relative market value.

# The Data and Wrangling

The data used for this project was a mixture of a public dataset from Kaggle (<https://www.kaggle.com/datasets/rohanrao/formula-1-world-championship-1950-2020>) with further enrichment from a package FastF1 (<https://theoehrly.github.io/Fast-F1/>).

This data was broken down into multiple sheets with cross referenced ids and had data available for races from 1950 to 2020. The sheets are broken down into mainly two types of data: reference data and result data. Not all data was used to create the models and a summary of the data used is listed below. Additionally, enhancements to some of the data was used to further enrich additional variables for data modeling.

+----------------+------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+
| Dataset Name   | Description                                                                  | Additional Enhancements                                                                             |
+================+==============================================================================+=====================================================================================================+
| qualifying.csv | Summary of qualifying session for each race. Data included all session times | Track Temp, Air Temp, Wind Speed was added via python package FastF1                                |
+----------------+------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+
| results.csv    | Summary of race results per driver and team                                  | Air Temp, Track Temp, Wind Speed, Weather, Car Performance Metric, Fastest Lap was found per driver |
+----------------+------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+

## Data Selection

Formula 1 as a sport has changed drastically over the years and is broken down into separate eras of similar cars based on their technology. We would like to compare as similar of cars as possible so the era chosen was the most recent era called the "Turbo-Hybrid" era which comes from the use of a hybrid engine along with turbos and occurred between 2014 to 2021 which is the subset of our analysis.

Furthermore, most contracts for drivers range between 1-5 years and many young drivers don't make it past 3-4 years in the sport. We decided to take data from 2018 to 2021 to build our model and make an applicable equivalency to a typical contract length and to keep similar drivers and teams.

#INSERT PARETO OF DRIVERS AND TEAMS

Based on the given dataset, there were 4 explanatory variables available to model our classification models. (grid, circuit, driver, fastest_speed) Our concern was the lack of variables given to us to produce models. A large effort was made to create additional variables such as Air.Temp, Track.Temp, Wind.Speed, Weather, Race.Circuit type (street or racing circuit), n_of_Sharp_Turns, car_performance (normalized against the fastest team per race), track_type based on speed, and turns per mile.

```{r , echo=FALSE}

```

To simply our split, we split the tracks above an average speed of 140 mph to be high speed tracks and everything below to be low speed tracks.

# Data Selection

In order to enrich our dataset, we used the ergast API through a package in Python called FastF1 to add additional environmental variables. Through the use of this package, we were able to add the variables, Track Temperature, Air Temperature, Wind Speed, Average Throttle Input (per driver), and Average Brake Input (per driver).

Formula 1 is broken down into separate eras of similar cars based on their technology. We would like to compare as similar cars as possible so the era chosen was the most recent era called the "Turbo-Hybrid" era which comes from the use of a hybrid engine along with turbos and stems from 2014 to 2020.

The dataset is broken up into qualifying.csv - this outlines all the times and laps set in

The inital dataset did not include weather and telemetry (e.g. full throttle, braking) data which was later enriched through our script in "Data_Enchancements.py".

## Data Preparation

```{r , echo=FALSE}
#circuit <- read_csv("Circuits_AVG_Top10Dry.csv")
#avg_speed <- as.vector(circuit$Avg_Speed_MPH)
#hist(avg_speed,breaks = 80)

```

# Purpose 1

To understand the differences between top, mid-tier, and backmarkers, we decided to run classification models for 3 different types of race results. In our first analysis, we looked at classification models to predict race wins.

### Race Wins:

To find the best classification model, we decided to run 3 different types of models: logistic regression, random forest, and XgBoost. With a 60/40 split in training to testing across all, we found the following accuracy, specificity, and sensitivity.

| Model Type          | Accuracy | Specificity | Sensitivity |
|---------------------|----------|-------------|-------------|
| Logistic Regression |          |             |             |
| Random Forest       |          |             |             |
| Gradient Boost      |          |             |             |

With logistic regression, we used the R builtin stepwise function to find the best fitting logistic regression model with the lowest AIC.

# ##INSERT ROC CURVES TO COMPARE FOR BEST MODEL 

# ##INSERT varIMP or Logistic Coefficients to explain Race wins

# ##Do this for Top 3 and Top 5.

# ##CONCLUSION FOR PURPOSE 1: What did we find was critical for winning, did those drivers seem to have an effect?  What about Top 3?  What about Top 5?  
